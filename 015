

この手順でPython3.6をインストール
https://qiita.com/softbase/items/0e60a7d5850d15b840e5


nginxインストール
https://qiita.com/NaokiIshimura/items/08aac94a184d1a00d39b


nginx.conf を以下の様に編集


#    include /etc/nginx/conf.d/*.conf;
    server {
      listen 80;
      server_name mchc-digital09.intra.sharedom.net;
      include /opt/app/nginx/*.conf;
      client_max_body_size 5M; # 413 Request Entity Too Large

    }



Firewall http許可
firewall-cmd --zone=public --add-service=http --permanent


/opt/app/qa_api_home を作成
git clone http://dx.intra.sharedom.net:8082/haba/qa_api.git


/opt/app/qa_api_home
venv 作成, qa_api の requirements.txt の内容をpip install


/opt/app/gunicorn/qa_api 
start_qa_api.sh を作成


(venv) [root@rcnuta301 qa_api]# cat start_qa_api.sh
#!/bin/sh

export APP_NAME=qa_api
export PYTHONPATH=/opt/app/${APP_NAME}_home/${APP_NAME}
export DJANGO_SETTINGS_MODULE=${APP_NAME}.settings

exec /opt/app/${APP_NAME}_home/venv/bin/gunicorn \
--workers=4 \
--bind=unix:/opt/app/${APP_NAME}_home/${APP_NAME}.sock ${APP_NAME}.wsgi:application \
--user=root \
--group=root


/etc/systemd/system


qa_api.service を作成
[Unit]
Description=django application service for qa_api
Before=nginx.service

[Service]
Type=simple
ExecStart=/opt/app/gunicorn/qa_api/start_qa_api.sh
Restart=always

[Install]
WantedBy=multi-user.target



/opt/app/nginx
qa_api.conf を作成

location /qa_api/ {
     proxy_pass http://unix:/opt/app/qa_api_home/qa_api.sock;
     proxy_set_header Host $host;
     proxy_set_header X-Real-IP $remote_addr;
     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
     proxy_set_header SCRIPT_NAME /qa_api;
     access_log /var/logs/nginx/qa_api/access.log main;
     error_log /var/logs/nginx/qa_api/error.log warn;
 }
location /qa_api/static/ {
     alias /opt/app/qa_api_home/qa_api/static/;
 }
location /qa_api/media/ {
     alias /opt/app/qa_api_home/qa_api/media/;
 }

location /qa-app/ {
    root /opt/app/qa_api_home;
    try_files $uri $uri/ /qa-app/index.html;

    proxy_set_header Host               $host;
    proxy_set_header X-Real-IP          $remote_addr;
    proxy_set_header X-Forwarded-For    $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto  $scheme;
 }


/var/logs/qa_api を作成


[root@rcnuta301 qa_api]# getenforce
Enforcing
[root@rcnuta301 qa_api]# setenforce 0
[root@rcnuta301 qa_api]# firewall-cmd --add-port=80/tcp --zone=public --permanent
success
[root@rcnuta301 qa_api]# firewall-cmd --reload
success
[root@rcnuta301 qa_api]# systemctl start nginx
[root@rcnuta301 qa_api]#
